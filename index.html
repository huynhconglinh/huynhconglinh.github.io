<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nh·∫≠t k√Ω ghi ch√∫</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { background: #f7f7f7; }
    .sidebar-custom {
      background: #f1f4f8;
      border-right: 1px solid #e0e0e0;
      min-height: 100vh;
    }
    .sidebar-actions { margin-top: 2rem; }
    .main-custom { background: #fff; min-height: 100vh; }
    .note-item { background: #f1f8ff; border-radius: 8px; padding: 1rem 1.2rem 2.2rem 1.2rem; margin-bottom: 1.2rem; box-shadow: 0 1px 4px #0001; position: relative; }
    .note-actions { position: absolute; top: 12px; right: 12px; display: flex; gap: 6px; }
    .note-time { position: absolute; right: 18px; bottom: 8px; font-size: 12px; color: #888; text-align: right; }
    .yt-history-link { cursor: pointer; color: #0d6efd; padding: 4px 0; border-bottom: 1px dashed #e0e0e0; font-size: 15px; transition: color 0.18s; word-break: break-all; }
    .yt-history-link:hover { color: #e74c3c; text-decoration: underline; }
    .youtube-aspect { aspect-ratio: 16/9; width: 100%; max-width: 1000px; margin: 0 auto; background: #000; border-radius: 8px; overflow: hidden; position: relative; }
    .youtube-aspect iframe { width: 100%; height: 100%; border: none; display: block; border-radius: 8px; background: #000; position: absolute; top: 0; left: 0; }
    .footer-bar { width: 100%; background: #fff; box-shadow: 0 -2px 8px #0001; display: flex; align-items: center; justify-content: center; position: fixed; bottom: 0; left: 0; z-index: 20; min-height: 44px; font-size: 15px; color: #888; letter-spacing: 0.2px; background: #f8fafd; }
    .header-logo { font-weight: bold; font-size: 20px; color: #3498db; letter-spacing: 1px; padding-left: 18px; }
    .note-content { white-space: pre-line; }
    @media (max-width: 900px) {
      .sidebar-custom, .main-custom, .right-custom { min-height: unset; }
    }
    .lang-dropdown {
      min-width: 120px;
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm sticky-top" style="z-index: 100;">
    <div class="container-fluid">
      <span class="navbar-brand header-logo">hclinh</span>
      <ul class="nav nav-tabs ms-auto me-2" id="mainTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="tabNotes" data-bs-toggle="tab" data-bs-target="#notesTab" type="button" role="tab" data-lang="notes">Ghi ch√∫</button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="tabYoutube" data-bs-toggle="tab" data-bs-target="#youtubeTab" type="button" role="tab" data-lang="youtube">YouTube</button>
        </li>
      </ul>
      <div class="dropdown lang-dropdown">
        <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          üåê <span id="currentLang">Ti·∫øng Vi·ªát</span>
        </button>
        <ul class="dropdown-menu" aria-labelledby="langDropdown">
          <li><a class="dropdown-item" href="#" onclick="setLang('vi')">Ti·∫øng Vi·ªát</a></li>
          <li><a class="dropdown-item" href="#" onclick="setLang('en')">English</a></li>
          <li><a class="dropdown-item" href="#" onclick="setLang('ja')">Êó•Êú¨Ë™û</a></li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="tab-content" id="mainTabContent">
    <div class="tab-pane fade show active" id="notesTab" role="tabpanel">
      <div class="container-fluid">
        <div class="row g-0">
          <aside class="col-12 col-md-3 sidebar-custom p-3">
            <ul class="list-group mb-3" id="dayList" style="border-radius:8px;"></ul>
            <div class="sidebar-actions d-grid gap-2">
              <button class="btn btn-primary" onclick="saveToFile()" data-lang="saveFile">L∆∞u ra file</button>
              <label class="btn btn-success" for="fileInput" tabindex="0" style="margin-bottom:0;" data-lang="loadFile">T·∫£i file l√™n</label>
              <input type="file" id="fileInput" accept=".json" onchange="loadFromFile(event)" style="display:none;">
            </div>
          </aside>
          <main class="col-12 col-md-6 main-custom p-4">
            <div class="notes-list" id="notesList"></div>
          </main>
          <aside class="col-12 col-md-3 right-custom bg-light p-3">
            <form class="note-form" id="noteForm" onsubmit="return addOrUpdateNote()">
              <div class="mb-2">
                <input type="text" id="title" class="form-control mb-2" placeholder="Ti√™u ƒë·ªÅ" required data-lang-placeholder="title" />
                <label for="noteDate" class="form-label" data-lang="date" style="display:none"></label>
                <input type="date" id="noteDate" class="form-control mb-2" required />
                <div class="toolbar mb-2 d-flex gap-1">
                  <button type="button" class="btn btn-outline-secondary btn-sm" title="In ƒë·∫≠m" onclick="insertMarkdown('bold')" data-lang-title="bold"><b>B</b></button>
                  <button type="button" class="btn btn-outline-secondary btn-sm" title="In nghi√™ng" onclick="insertMarkdown('italic')" data-lang-title="italic"><i>I</i></button>
                  <button type="button" class="btn btn-outline-secondary btn-sm" title="G·∫°ch ngang" onclick="insertMarkdown('strike')" data-lang-title="strike"><s>S</s></button>
                  <button type="button" class="btn btn-outline-secondary btn-sm" title="Ti√™u ƒë·ªÅ l·ªõn" onclick="insertMarkdown('h1')" data-lang-title="h1">H1</button>
                  <button type="button" class="btn btn-outline-secondary btn-sm" title="Danh s√°ch" onclick="insertMarkdown('ul')" data-lang-title="ul">‚Ä¢</button>
                  <button type="button" class="btn btn-outline-secondary btn-sm" title="Danh s√°ch s·ªë" onclick="insertMarkdown('ol')" data-lang-title="ol">1.</button>
                </div>
                <textarea id="content" class="form-control mb-2" placeholder="N·ªôi dung ghi ch√∫..." required data-lang-placeholder="content"></textarea>
                <input type="hidden" id="editIndex" value="" />
                <div class="d-flex justify-content-end gap-2">
                  <button type="submit" id="addBtn" class="btn btn-primary" data-lang="addNote">Th√™m ghi ch√∫</button>
                  <button type="button" id="cancelEditBtn" class="btn btn-secondary" style="display:none;" onclick="cancelEdit()" data-lang="cancelEdit">Hu·ª∑ s·ª≠a</button>
                </div>
              </div>
            </form>
          </aside>
        </div>
      </div>
    </div>
    <div class="tab-pane fade" id="youtubeTab" role="tabpanel">
      <div class="container py-4">
        <form onsubmit="return showYoutubeVideo()" class="row g-2 align-items-center mb-3">
          <div class="col-auto">
            <button type="submit" class="btn btn-danger" data-lang="view">Xem</button>
          </div>
          <div class="col">
            <input type="url" id="youtubeLink" class="form-control" placeholder="D√°n link YouTube..." required data-lang-placeholder="youtubePlaceholder" />
          </div>
        </form>
        <div id="youtubePlayer" class="mb-3"></div>
        <div id="youtubeHistory" class="youtube-history"></div>
      </div>
    </div>
  </div>
  <div class="footer-bar" data-lang="copyright">
    ¬© 2024 hclinh. All rights reserved.
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    let notes = [];
    let selectedDay = '';
    let youtubeHistory = JSON.parse(localStorage.getItem('youtubeHistory') || '[]');

    // ƒêa ng√¥n ng·ªØ
    const translations = {
      vi: {
        addNote: "Th√™m ghi ch√∫",
        updateNote: "C·∫≠p nh·∫≠t",
        cancelEdit: "Hu·ª∑ s·ª≠a",
        title: "Ti√™u ƒë·ªÅ",
        content: "N·ªôi dung ghi ch√∫...",
        date: "Ng√†y t·∫°o",
        saveFile: "L∆∞u ra file",
        loadFile: "T·∫£i file l√™n",
        noNote: "Ch∆∞a c√≥ ghi ch√∫ n√†o.",
        noNoteDay: "Ch∆∞a c√≥ ghi ch√∫ n√†o cho ng√†y n√†y.",
        edit: "S·ª≠a",
        del: "Xo√°",
        up: "L√™n",
        down: "Xu·ªëng",
        youtube: "YouTube",
        notes: "Ghi ch√∫",
        view: "Xem",
        history: "L·ªãch s·ª≠ video ƒë√£ xem:",
        copyright: "¬© 2024 hclinh. All rights reserved.",
        youtubePlaceholder: "D√°n link YouTube...",
        confirmDelete: "B·∫°n c√≥ ch·∫Øc mu·ªën xo√° ghi ch√∫ n√†y?",
        edited: "ƒë√£ s·ª≠a",
        bold: "In ƒë·∫≠m",
        italic: "In nghi√™ng",
        strike: "G·∫°ch ngang",
        h1: "Ti√™u ƒë·ªÅ l·ªõn",
        ul: "Danh s√°ch",
        ol: "Danh s√°ch s·ªë"
      },
      en: {
        addNote: "Add Note",
        updateNote: "Update",
        cancelEdit: "Cancel",
        title: "Title",
        content: "Note content...",
        date: "Date",
        saveFile: "Save to file",
        loadFile: "Load file",
        noNote: "No notes yet.",
        noNoteDay: "No notes for this day.",
        edit: "Edit",
        del: "Delete",
        up: "Up",
        down: "Down",
        youtube: "YouTube",
        notes: "Notes",
        view: "View",
        history: "Watched video history:",
        copyright: "¬© 2024 hclinh. All rights reserved.",
        youtubePlaceholder: "Paste YouTube link...",
        confirmDelete: "Are you sure you want to delete this note?",
        edited: "edited",
        bold: "Bold",
        italic: "Italic",
        strike: "Strikethrough",
        h1: "Heading 1",
        ul: "Unordered list",
        ol: "Ordered list"
      },
      ja: {
        addNote: "„Éé„Éº„ÉàËøΩÂä†",
        updateNote: "Êõ¥Êñ∞",
        cancelEdit: "„Ç≠„É£„É≥„Çª„É´",
        title: "„Çø„Ç§„Éà„É´",
        content: "„Éé„Éº„ÉàÂÜÖÂÆπ...",
        date: "Êó•‰ªò",
        saveFile: "„Éï„Ç°„Ç§„É´„Å´‰øùÂ≠ò",
        loadFile: "„Éï„Ç°„Ç§„É´„ÇíË™≠„ÅøËæº„ÇÄ",
        noNote: "„Éé„Éº„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
        noNoteDay: "„Åì„ÅÆÊó•„Å´„Éé„Éº„Éà„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ",
        edit: "Á∑®ÈõÜ",
        del: "ÂâäÈô§",
        up: "‰∏ä„Å∏",
        down: "‰∏ã„Å∏",
        youtube: "YouTube",
        notes: "„Éé„Éº„Éà",
        view: "Ë°®Á§∫",
        history: "Ë¶ñËÅ¥Â±•Ê≠¥:",
        copyright: "¬© 2024 hclinh. All rights reserved.",
        youtubePlaceholder: "YouTube„É™„É≥„ÇØ„ÇíË≤º„Çä‰ªò„Åë...",
        confirmDelete: "„Åì„ÅÆ„Éé„Éº„Éà„ÇíÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åô„ÅãÔºü",
        edited: "Á∑®ÈõÜÊ∏à„Åø",
        bold: "Â§™Â≠ó",
        italic: "Êñú‰Ωì",
        strike: "Âèñ„ÇäÊ∂à„ÅóÁ∑ö",
        h1: "Ë¶ãÂá∫„Åó1",
        ul: "ÁÆáÊù°Êõ∏„Åç",
        ol: "Áï™Âè∑‰ªò„Åç„É™„Çπ„Éà"
      }
    };
    let currentLang = localStorage.getItem('lang') || 'vi';
    function setLang(lang) {
      currentLang = lang;
      localStorage.setItem('lang', lang);
      updateLang();
    }
    function t(key) { return translations[currentLang][key] || key; }
    function updateLang() {
      // T·ª± ƒë·ªông c·∫≠p nh·∫≠t text/placeholder/title cho m·ªçi ph·∫ßn t·ª≠ c√≥ data-lang, data-lang-placeholder, data-lang-title
      document.querySelectorAll('[data-lang]').forEach(el => {
        if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
          el.placeholder = t(el.getAttribute('data-lang'));
        } else {
          el.textContent = t(el.getAttribute('data-lang'));
        }
      });
      document.querySelectorAll('[data-lang-placeholder]').forEach(el => {
        el.placeholder = t(el.getAttribute('data-lang-placeholder'));
      });
      document.querySelectorAll('[data-lang-title]').forEach(el => {
        el.title = t(el.getAttribute('data-lang-title'));
      });
      // ƒê·∫∑c bi·ªát cho label ng√†y (·∫©n) n·∫øu c√≥
      var dateLabel = document.querySelector('label[for="noteDate"][data-lang="date"]');
      if (dateLabel) dateLabel.textContent = t('date');
      // ƒê·ªïi t√™n ng√¥n ng·ªØ hi·ªán t·∫°i tr√™n dropdown
      document.getElementById('currentLang').textContent =
        currentLang === 'vi' ? 'Ti·∫øng Vi·ªát' : (currentLang === 'en' ? 'English' : 'Êó•Êú¨Ë™û');
      // Ghi ch√∫ v√† sidebar s·∫Ω t·ª± ƒë·ªông c·∫≠p nh·∫≠t khi renderNotes/renderDayList
      renderDayList();
      renderNotes();
      renderYoutubeHistory();
    }

    function getDayStr(dateObj) {
      // Tr·∫£ v·ªÅ YYYY-MM-dd
      return dateObj.toISOString().slice(0, 10);
    }

    function groupNotesByDay() {
      const groups = {};
      notes.forEach((note, idx) => {
        const day = note.day || note.date.slice(0, 10);
        if (!groups[day]) groups[day] = [];
        groups[day].push({ ...note, _idx: idx });
      });
      return groups;
    }

    function renderDayList() {
      const dayList = document.getElementById('dayList');
      const groups = groupNotesByDay();
      const days = Object.keys(groups).sort((a, b) => b.localeCompare(a));
      dayList.innerHTML = '';
      if (days.length === 0) {
        dayList.innerHTML = `<li class="list-group-item text-center text-muted">${t('noNote')}</li>`;
        selectedDay = '';
        renderNotes();
        return;
      }
      days.forEach(day => {
        const li = document.createElement('li');
        li.className = 'list-group-item p-2';
        li.style.cursor = 'pointer';
        li.innerHTML = `<div class="d-flex justify-content-between align-items-center">
          <span class="fw-bold">${day}</span>
          <span class="badge bg-primary rounded-pill ms-2">${groups[day].length}</span>
        </div>`;
        // Danh s√°ch ti√™u ƒë·ªÅ ghi ch√∫ n·∫øu ng√†y ƒëang m·ªü
        if (day === selectedDay) {
          const noteTitlesUl = document.createElement('ul');
          noteTitlesUl.className = 'list-group list-group-flush mt-2';
          groups[day].forEach((note, idx) => {
            const noteLi = document.createElement('li');
            noteLi.className = 'list-group-item py-1 px-2';
            noteLi.style.cursor = 'pointer';
            noteLi.style.fontSize = '15px';
            noteLi.innerText = note.title;
            noteLi.title = note.title;
            noteLi.onclick = (e) => {
              e.stopPropagation();
              const noteDiv = document.getElementById('note-' + note._idx);
              if (noteDiv) {
                noteDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                noteDiv.classList.add('border-primary');
                setTimeout(() => noteDiv.classList.remove('border-primary'), 1200);
              }
            };
            noteTitlesUl.appendChild(noteLi);
          });
          li.appendChild(noteTitlesUl);
        }
        li.onclick = () => {
          selectedDay = (selectedDay === day) ? '' : day;
          renderDayList();
          renderNotes();
          cancelEdit();
        };
        if (day === selectedDay) li.classList.add('active');
        dayList.appendChild(li);
      });
      if (!selectedDay && days.length > 0) {
        selectedDay = days[0];
        renderDayList();
        renderNotes();
      }
    }

    function renderNotes() {
      const notesList = document.getElementById('notesList');
      if (!selectedDay) {
        notesList.innerHTML = `<div class="alert alert-secondary">${t('noNote')}</div>`;
        return;
      }
      const groups = groupNotesByDay();
      const dayNotes = groups[selectedDay] || [];
      notesList.innerHTML = '';
      if (dayNotes.length === 0) {
        notesList.innerHTML = `<div class="alert alert-secondary">${t('noNoteDay')}</div>`;
        return;
      }
      dayNotes.forEach((note, idx) => {
        const noteDiv = document.createElement('div');
        noteDiv.className = 'card note-item mb-3';
        noteDiv.id = 'note-' + note._idx;
        noteDiv.innerHTML = `
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <div class="fw-bold text-primary">${escapeHTML(note.title)}</div>
              <div class="btn-group btn-group-sm note-actions" role="group">
                <button class="btn btn-warning" onclick="moveNote(${note._idx}, -1)" title="${t('up')}">‚ñ≤</button>
                <button class="btn btn-warning" onclick="moveNote(${note._idx}, 1)" title="${t('down')}">‚ñº</button>
                <button class="btn btn-info text-white" onclick="editNote(${note._idx})">${t('edit')}</button>
                <button class="btn btn-danger" onclick="deleteNote(${note._idx})">${t('del')}</button>
              </div>
            </div>
            <div class="note-content">${marked.parse(note.content)}</div>
            <div class="note-time text-end text-muted mt-2" style="font-size:13px;">${note.date}</div>
          </div>
        `;
        notesList.appendChild(noteDiv);
      });
    }

    function addOrUpdateNote() {
      const title = document.getElementById('title').value.trim();
      const content = document.getElementById('content').value.trim();
      const noteDate = document.getElementById('noteDate').value;
      const editIndex = document.getElementById('editIndex').value;
      if (!title || !content || !noteDate) return false;
      const now = new Date();
      const dateStr = now.toLocaleString('vi-VN');
      const dayStr = noteDate;
      if (editIndex === '') {
        // Th√™m m·ªõi
        notes.unshift({ day: dayStr, date: dateStr, title, content });
        selectedDay = dayStr;
      } else {
        // S·ª≠a
        notes[editIndex].title = title;
        notes[editIndex].content = content;
        notes[editIndex].date = dateStr + ' (' + t('edited') + ')';
        notes[editIndex].day = dayStr;
        selectedDay = notes[editIndex].day;
      }
      renderDayList();
      renderNotes();
      document.getElementById('noteForm').reset();
      document.getElementById('editIndex').value = '';
      document.getElementById('addBtn').textContent = t('addNote');
      document.getElementById('cancelEditBtn').style.display = 'none';
      // ƒê·∫∑t l·∫°i ng√†y v·ªÅ h√¥m nay sau khi th√™m/s·ª≠a (n·∫øu kh√¥ng ph·∫£i ƒëang edit)
      if (!document.getElementById('editIndex').value) {
        document.getElementById('noteDate').value = (new Date()).toISOString().slice(0, 10);
      }
      return false;
    }

    function editNote(idx) {
      const note = notes[idx];
      document.getElementById('title').value = note.title;
      document.getElementById('content').value = note.content;
      document.getElementById('editIndex').value = idx;
      document.getElementById('addBtn').textContent = t('updateNote');
      document.getElementById('cancelEditBtn').style.display = '';
      document.getElementById('noteDate').value = note.day || (new Date()).toISOString().slice(0, 10);
    }

    function cancelEdit() {
      document.getElementById('noteForm').reset();
      document.getElementById('editIndex').value = '';
      document.getElementById('addBtn').textContent = t('addNote');
      document.getElementById('cancelEditBtn').style.display = 'none';
      document.getElementById('noteDate').value = (new Date()).toISOString().slice(0, 10);
    }

    function deleteNote(idx) {
      if (confirm(t('confirmDelete'))) {
        notes.splice(idx, 1);
        renderDayList();
        renderNotes();
        cancelEdit();
      }
    }

    function saveToFile() {
      const blob = new Blob([JSON.stringify(notes, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'nhatky-ghichu.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function loadFromFile(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          if (Array.isArray(data)) {
            notes = data;
            renderDayList();
            renderNotes();
            cancelEdit();
          } else {
            alert('File kh√¥ng h·ª£p l·ªá!');
          }
        } catch {
          alert('File kh√¥ng h·ª£p l·ªá!');
        }
      };
      reader.readAsText(file);
    }

    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, function(tag) {
        const chars = {
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;'
        };
        return chars[tag] || tag;
      });
    }

    function insertMarkdown(type) {
      const textarea = document.getElementById('content');
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      let before = textarea.value.substring(0, start);
      let after = textarea.value.substring(end);
      let selected = textarea.value.substring(start, end);
      let insertText = '', cursorMove = 0;
      if ((type === 'ul' || type === 'ol') && selected.includes('\n')) {
        // N·∫øu ch·ªçn nhi·ªÅu d√≤ng, √°p d·ª•ng cho t·ª´ng d√≤ng
        const lines = selected.split(/\r?\n/);
        if (type === 'ul') {
          insertText = lines.map(line => line ? `- ${line}` : '').join('\n');
        } else {
          insertText = lines.map((line, idx) => line ? `${idx + 1}. ${line}` : '').join('\n');
        }
        cursorMove = 0;
      } else {
        switch(type) {
          case 'bold':
            insertText = `**${selected || 'ƒë·∫≠m'}**`;
            cursorMove = selected ? 0 : 2;
            break;
          case 'italic':
            insertText = `*${selected || 'nghi√™ng'}*`;
            cursorMove = selected ? 0 : 1;
            break;
          case 'strike':
            insertText = `~~${selected || 'g·∫°ch'}~~`;
            cursorMove = selected ? 0 : 2;
            break;
          case 'h1':
            insertText = `# ${selected || 'Ti√™u ƒë·ªÅ l·ªõn'}`;
            cursorMove = selected ? 0 : 2;
            break;
          case 'ul':
            insertText = `- ${selected || 'G·∫°ch ƒë·∫ßu d√≤ng'}`;
            cursorMove = selected ? 0 : 2;
            break;
          case 'ol':
            insertText = `1. ${selected || 'S·ªë th·ª© t·ª±'}`;
            cursorMove = selected ? 0 : 3;
            break;
        }
      }
      textarea.value = before + insertText + after;
      // ƒê·∫∑t l·∫°i v·ªã tr√≠ con tr·ªè
      const newPos = before.length + insertText.length - cursorMove;
      textarea.focus();
      textarea.setSelectionRange(newPos, newPos);
    }

    function moveNote(idx, direction) {
      // idx l√† index trong m·∫£ng notes (to√†n b·ªô), direction: -1 (up), 1 (down)
      const note = notes[idx];
      // L·ªçc ra c√°c notes c√πng ng√†y
      const day = note.day;
      const dayNotesIdx = notes
        .map((n, i) => ({ n, i }))
        .filter(obj => obj.n.day === day)
        .map(obj => obj.i);
      const pos = dayNotesIdx.indexOf(idx);
      if (pos === -1) return;
      const swapWith = pos + direction;
      if (swapWith < 0 || swapWith >= dayNotesIdx.length) return;
      // ƒê·ªïi ch·ªó trong m·∫£ng notes
      const idx2 = dayNotesIdx[swapWith];
      [notes[idx], notes[idx2]] = [notes[idx2], notes[idx]];
      renderDayList();
      renderNotes();
    }

    function showYoutubeVideo() {
      const link = document.getElementById('youtubeLink').value.trim();
      const playerDiv = document.getElementById('youtubePlayer');
      const videoId = extractYoutubeId(link);
      if (!videoId) {
        playerDiv.innerHTML = '<div style="color:#e74c3c;">Link kh√¥ng h·ª£p l·ªá!</div>';
        return false;
      }
      const embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}`;
      playerDiv.innerHTML = `<div class='youtube-aspect'><iframe src="${embedUrl}" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe></div>`;
      saveYoutubeHistory(link);
      renderYoutubeHistory();
      return false;
    }

    function extractYoutubeId(url) {
      // H·ªó tr·ª£ nhi·ªÅu d·∫°ng link YouTube
      const regExp = /^.*(?:youtu.be\/|v=|u=\w\/|embed\/|shorts\/|watch\?v=|watch\?.+&v=)([^#&?\n\r\s]{11}).*/;
      const match = url.match(regExp);
      return match ? match[1] : null;
    }

    function saveYoutubeHistory(link) {
      if (!youtubeHistory.includes(link)) {
        youtubeHistory.unshift(link);
        if (youtubeHistory.length > 20) youtubeHistory = youtubeHistory.slice(0, 20);
        localStorage.setItem('youtubeHistory', JSON.stringify(youtubeHistory));
      }
    }

    function renderYoutubeHistory() {
      const historyDiv = document.getElementById('youtubeHistory');
      if (!historyDiv) return;
      if (youtubeHistory.length === 0) {
        historyDiv.innerHTML = '';
        return;
      }
      historyDiv.innerHTML = `<div style="font-weight:500;margin:18px 0 6px 0;">${t('history')}</div>` +
        youtubeHistory.map(link => `<div class=\"yt-history-link\" data-link=\"${encodeURIComponent(link)}\">${escapeHTML(link)}</div>`).join('');
      // G√°n s·ª± ki·ªán click cho t·ª´ng link
      Array.from(historyDiv.querySelectorAll('.yt-history-link')).forEach(el => {
        el.onclick = function() {
          playYoutubeHistory(decodeURIComponent(this.getAttribute('data-link')));
        };
      });
    }

    function playYoutubeHistory(link) {
      document.getElementById('youtubeLink').value = link;
      showYoutubeVideo();
    }

    // Kh·ªüi t·∫°o giao di·ªán
    renderDayList();
    renderNotes();
    // ƒê·∫∑t ng√†y m·∫∑c ƒë·ªãnh l√† h√¥m nay khi load trang
    document.getElementById('noteDate').value = (new Date()).toISOString().slice(0, 10);
    // ƒê·ªïi ng√¥n ng·ªØ khi load trang
    updateLang();
  </script>
</body>
</html> 
